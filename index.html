<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSK Automobiles - Premium Auto Service Since 1995</title>
    <link rel="stylesheet" href="styles.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <style>
        /* Landing Page Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Header */
        .landing-header {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            color: white;
            padding: 15px 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .logo-section p {
            font-size: 14px;
            opacity: 0.9;
        }

        .header-login-btn {
            background: white;
            color: #2563eb;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .header-login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255,255,255,0.3);
        }

        /* Hero Section */
        .hero-section {
            margin-top: 80px;
            background: linear-gradient(135deg, #dbeafe 0%, #ffffff 100%);
            padding: 80px 20px;
            text-align: center;
        }

        .hero-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .hero-section h2 {
            font-size: 48px;
            color: #1e40af;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .hero-section .tagline {
            font-size: 24px;
            color: #374151;
            margin-bottom: 40px;
        }

        .ratings-container {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 40px 0;
            flex-wrap: wrap;
        }

        .rating-card {
            background: white;
            padding: 25px 40px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left: 4px solid #f59e0b;
        }

        .rating-card .stars {
            font-size: 32px;
            color: #f59e0b;
            margin-bottom: 10px;
        }

        .rating-card .rating-text {
            font-size: 24px;
            font-weight: 700;
            color: #2563eb;
            margin-bottom: 5px;
        }

        .rating-card .platform {
            font-size: 14px;
            color: #6b7280;
        }

        /* Info Section */
        .info-section {
            max-width: 1200px;
            margin: 60px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .info-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-top: 4px solid #2563eb;
        }

        .info-card h3 {
            font-size: 22px;
            color: #2563eb;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-card .icon {
            font-size: 28px;
        }

        .info-card p {
            font-size: 16px;
            color: #374151;
            line-height: 1.8;
            margin-bottom: 10px;
        }

        .info-card strong {
            color: #1e40af;
        }

        /* Contact Section */
        .contact-section {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            color: white;
            padding: 60px 20px;
            text-align: center;
        }

        .contact-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .contact-section h2 {
            font-size: 36px;
            margin-bottom: 30px;
        }

        .contact-details {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 40px 0;
        }

        .contact-item {
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .contact-item .icon {
            font-size: 24px;
        }

        .map-button {
            background: #ef4444;
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .map-button:hover {
            background: #dc2626;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        /* Working Hours */
        .hours-card {
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 12px;
            margin-top: 30px;
            backdrop-filter: blur(10px);
        }

        .hours-card h3 {
            font-size: 22px;
            margin-bottom: 20px;
        }

        .hours-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .hours-item:last-child {
            border-bottom: none;
        }

        /* Login Modal */
        .login-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .login-modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .login-modal-content {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            max-width: 450px;
            width: 90%;
            position: relative;
        }

        .close-modal {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 28px;
            font-weight: bold;
            color: #6b7280;
            cursor: pointer;
            line-height: 1;
        }

        .close-modal:hover {
            color: #374151;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero-section h2 {
                font-size: 32px;
            }

            .hero-section .tagline {
                font-size: 18px;
            }

            .ratings-container {
                flex-direction: column;
                align-items: center;
            }

            .header-container {
                flex-direction: column;
                gap: 15px;
            }

            .logo-section h1 {
                font-size: 22px;
                text-align: center;
            }
        }

        /* Toast */
        .toast {
            background: white;
            padding: 16px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            animation: slideIn 0.3s ease;
            border-left: 4px solid #2563eb;
        }
        .toast.success { border-left-color: #10b981; }
        .toast.error { border-left-color: #ef4444; }
        .toast-icon { font-size: 20px; flex-shrink: 0; }
        .toast.success .toast-icon { color: #10b981; }
        .toast.error .toast-icon { color: #ef4444; }
        .toast-message { flex: 1; color: #374151; font-size: 14px; font-weight: 500; }
        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(400px); opacity: 0; }
        }
        .toast.hiding { animation: slideOut 0.3s ease forwards; }
    </style>
</head>
<body>
    <!-- Toast Notification Container -->
    <div id="toastContainer" style="position: fixed; top: 20px; right: 20px; z-index: 10000;"></div>

    <!-- Landing Page -->
    <div id="landingPage">
        <!-- Header -->
        <header class="landing-header">
            <div class="header-container">
                <div class="logo-section">
                    <h1>CSK AUTOMOBILES</h1>
                    <p>Trusted Auto Care Since 1995</p>
                </div>
                <button class="header-login-btn" onclick="showLoginModal()">Login / Register</button>
            </div>
        </header>

        <!-- Hero Section -->
        <section class="hero-section">
            <div class="hero-container">
                <h2>Welcome to CSK Automobiles</h2>
                <p class="tagline">30+ Years of Excellence in Automotive Service</p>
                
                <div class="ratings-container">
                    <div class="rating-card">
                        <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                        <div class="rating-text">4.7/5</div>
                        <div class="platform">Google Reviews</div>
                    </div>
                    <div class="rating-card">
                        <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                        <div class="rating-text">4.6/5</div>
                        <div class="platform">JustDial</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Info Section -->
        <section class="info-section">
            <div class="info-card" style="text-align: center; padding: 40px 30px;">
                <img src="https://res.cloudinary.com/dfol7xlwr/image/upload/v1762162523/WhatsApp_Image_2025-11-03_at_09.34.06_7483fe2f_x0pjml.jpg" 
                     alt="C Siva Kumar" 
                     style="width: 200px; 
                            height: 200px; 
                            border-radius: 50%; 
                            object-fit: cover; 
                            border: 6px solid #2563eb; 
                            margin: 0 auto 25px auto; 
                            display: block;
                            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.3);">
                <h3 style="margin-top: 15px; font-size: 24px; color: #2563eb;">Owner & Founder</h3>
                <p style="font-size: 20px; font-weight: 700; color: #1e40af; margin: 15px 0;">C SIVA KUMAR</p>
                <p style="font-size: 16px; line-height: 1.8;">With over 30 years of hands-on experience in automotive repair and maintenance, bringing expert care to every vehicle.</p>
            </div>

            <div class="info-card">
                <h3><span class="icon">üìû</span> Contact Us</h3>
                <p><strong>Primary:</strong> 9444214412</p>
                <p><strong>Secondary:</strong> 9659940179</p>
                <p>Call us anytime during working hours for immediate assistance!</p>
            </div>

            <div class="info-card">
                <h3><span class="icon">üèÜ</span> Experience</h3>
                <p><strong>Established: 1995</strong></p>
                <p><strong>30+ Years</strong> of trusted service</p>
                <p>Serving Chennai with dedication and expertise for three decades.</p>
            </div>
        </section>

        <!-- Contact Section -->
        <section class="contact-section">
            <div class="contact-container">
                <h2>Visit Us Today</h2>
                
                <div class="contact-details">
                    <div class="contact-item">
                        <span class="icon">üìç</span>
                        <span>No 33, Nehru St, MGR Nagar, Chitlapakkam, Chennai - 600064</span>
                    </div>
                </div>

                <a href="https://www.google.com/maps?um=1&ie=UTF-8&fb=1&gl=in&sa=X&geocode=Ke2PAswBX1I6MXOiPfq6TsAh&daddr=No+33,+Nehru+St,+MGR+Nagar,+Chitlapakkam,+Chennai,+Tamil+Nadu+600064" 
                   target="_blank" 
                   class="map-button">
                    <span>üìç</span> Navigate to Our Workshop
                </a>

                <div class="hours-card">
                    <h3>‚è∞ Working Hours</h3>
                    <div class="hours-item">
                        <span><strong>Monday - Saturday</strong></span>
                        <span>9:00 AM - 9:00 PM</span>
                    </div>
                    <div class="hours-item">
                        <span><strong>Sunday</strong></span>
                        <span>9:00 AM - 1:00 PM</span>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="login-modal">
        <div class="login-modal-content">
            <span class="close-modal" onclick="closeLoginModal()">&times;</span>
            
            <h1 style="color: #2563eb; margin-bottom: 8px; text-align: center;">Login</h1>
            <p class="subtitle" style="text-align: center; color: #6b7280; margin-bottom: 30px;">Please select your login type</p>
            
            <div class="login-type-selector">
                <button class="btn-type active" data-type="customer">Customer Login</button>
                <button class="btn-type" data-type="admin">Admin Login</button>
            </div>

            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" required placeholder="Enter your email">
                </div>

                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" required placeholder="Enter your password">
                </div>

                <button type="submit" class="btn-primary">Login</button>
            </form>

            <div style="text-align: center; margin-top: 15px;">
                <a href="#" id="forgotPasswordLink" style="color: #2563eb; text-decoration: none; font-size: 14px; font-weight: 500;">Forgot Password?</a>
            </div>

            <div class="register-link">
                <p>New customer? <a href="register.html">Register here</a></p>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgotPasswordModal" class="modal">
        <div class="modal-content">
            <h2>Reset Password</h2>
            <p style="color: #6b7280; margin-bottom: 20px; font-size: 14px;">Enter your registered email to receive a password reset code</p>
            
            <form id="forgotPasswordForm">
                <div class="form-group">
                    <label for="resetEmail">Email Address</label>
                    <input type="email" id="resetEmail" required placeholder="Enter your registered email">
                </div>
                <button type="submit" class="btn-primary">Send Reset Code</button>
            </form>
            
            <div style="text-align: center; margin-top: 15px;">
                <a href="#" onclick="closeForgotPasswordModal()" style="color: #2563eb; text-decoration: none; font-size: 14px;">Back to Login</a>
            </div>
        </div>
    </div>

    <!-- Reset Password Modal with OTP -->
    <div id="resetPasswordModal" class="modal">
        <div class="modal-content">
            <h2>Enter Reset Code</h2>
            <p>Enter the 6-digit code sent to <span id="resetEmailDisplay" style="color: #2563eb; font-weight: 600;"></span></p>
            
            <div class="otp-inputs">
                <input type="text" class="reset-otp-input" maxlength="1" inputmode="numeric" />
                <input type="text" class="reset-otp-input" maxlength="1" inputmode="numeric" />
                <input type="text" class="reset-otp-input" maxlength="1" inputmode="numeric" />
                <input type="text" class="reset-otp-input" maxlength="1" inputmode="numeric" />
                <input type="text" class="reset-otp-input" maxlength="1" inputmode="numeric" />
                <input type="text" class="reset-otp-input" maxlength="1" inputmode="numeric" />
            </div>
            
            <form id="newPasswordForm" style="margin-top: 20px;">
                <div class="form-group">
                    <label for="newPassword">New Password</label>
                    <input type="password" id="newPassword" required placeholder="Enter new password" minlength="6">
                </div>
                <div class="form-group">
                    <label for="confirmNewPassword">Confirm Password</label>
                    <input type="password" id="confirmNewPassword" required placeholder="Confirm new password">
                </div>
                <button type="submit" class="btn-primary">Reset Password</button>
            </form>
            
            <p class="resend-otp" style="text-align: center; margin-top: 15px;">
                Didn't receive code? <a href="#" id="resendResetOtp">Resend Code</a>
            </p>
            <div id="resetOtpTimer" style="text-align: center; color: #6b7280; margin-top: 10px; font-size: 14px;"></div>
        </div>
    </div>

    <!-- OTP Verification Modal -->
    <div id="otpModal" class="modal">
        <div class="modal-content">
            <h2>Verify OTP</h2>
            <p>Enter the 6-digit code sent to <span id="emailDisplay" style="color: #2563eb; font-weight: 600;"></span></p>
            <div class="otp-inputs">
                <input type="text" class="otp-input" maxlength="1" inputmode="numeric" />
                <input type="text" class="otp-input" maxlength="1" inputmode="numeric" />
                <input type="text" class="otp-input" maxlength="1" inputmode="numeric" />
                <input type="text" class="otp-input" maxlength="1" inputmode="numeric" />
                <input type="text" class="otp-input" maxlength="1" inputmode="numeric" />
                <input type="text" class="otp-input" maxlength="1" inputmode="numeric" />
            </div>
            <button class="btn-primary" id="verifyOtpBtn">Verify OTP</button>
            <p class="resend-otp">Didn't receive code? <a href="#" id="resendOtp">Resend OTP</a></p>
            <div id="otpTimer" style="text-align: center; color: #6b7280; margin-top: 10px; font-size: 14px;"></div>
        </div>
    </div>

    <script>
        const EMAILJS_CONFIG = {
            PUBLIC_KEY: 'kG6B7Cff-xvHUOkh7',
            SERVICE_ID: 'service_vdbaisk',
            TEMPLATE_ID: 'template_gahxvgv'
        };
        
        let selectedLoginType = 'customer';
        let currentLoginUser = null;
        let otpTimerInterval = null;
        let resetOtpTimerInterval = null;
        
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            const icon = type === 'success' ? '‚úì' : '‚úï';
            toast.innerHTML = `<span class="toast-icon">${icon}</span><span class="toast-message">${message}</span>`;
            container.appendChild(toast);
            setTimeout(() => {
                toast.classList.add('hiding');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        function showLoginModal() {
            document.getElementById('loginModal').classList.add('show');
        }
        
        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('show');
        }
        
        function showForgotPasswordModal() {
            document.getElementById('forgotPasswordModal').classList.add('show');
        }
        
        function closeForgotPasswordModal() {
            document.getElementById('forgotPasswordModal').classList.remove('show');
            document.getElementById('forgotPasswordForm').reset();
        }
        
        function showResetPasswordModal() {
            document.getElementById('resetPasswordModal').classList.add('show');
            setupResetOTPInputs();
            startResetOTPTimer();
        }
        
        function closeResetPasswordModal() {
            document.getElementById('resetPasswordModal').classList.remove('show');
            document.getElementById('newPasswordForm').reset();
            if (resetOtpTimerInterval) clearInterval(resetOtpTimerInterval);
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeStorage();
            initializeEmailJS();
            setupLoginPage();
        });
        
        function initializeEmailJS() {
            if (EMAILJS_CONFIG.PUBLIC_KEY !== 'YOUR_EMAILJS_PUBLIC_KEY') {
                try {
                    emailjs.init({ publicKey: EMAILJS_CONFIG.PUBLIC_KEY });
                    console.log('EmailJS initialized');
                } catch (error) {
                    console.error('EmailJS error:', error);
                }
            }
        }
        
        function initializeStorage() {
            let users = JSON.parse(localStorage.getItem('users')) || [];
            
            const adminIndex = users.findIndex(u => u.userType === 'admin');
            
            const adminData = {
                userId: 'ADMIN-001',
                name: 'Mahesh Admin',
                email: 'mahesh2332005@gmail.com',
                password: 'cskadmin123@7010099085',
                phone: '7010099085',
                userType: 'admin',
                verified: true,
                registeredDate: new Date().toISOString()
            };
            
            if (adminIndex !== -1) {
                users[adminIndex] = adminData;
            } else {
                users.push(adminData);
            }
            
            localStorage.setItem('users', JSON.stringify(users));
            
            if (!localStorage.getItem('serviceRequests')) {
                localStorage.setItem('serviceRequests', JSON.stringify([]));
            }
            if (!localStorage.getItem('appointments')) {
                localStorage.setItem('appointments', JSON.stringify([]));
            }
            if (!localStorage.getItem('pointsHistory')) {
                localStorage.setItem('pointsHistory', JSON.stringify([]));
            }
        }
        
        function setupLoginPage() {
            const loginTypeButtons = document.querySelectorAll('.btn-type');
            const loginForm = document.getElementById('loginForm');
            const forgotPasswordLink = document.getElementById('forgotPasswordLink');
            const forgotPasswordForm = document.getElementById('forgotPasswordForm');
            const newPasswordForm = document.getElementById('newPasswordForm');
            const resendResetOtp = document.getElementById('resendResetOtp');
            
            loginTypeButtons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    loginTypeButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    selectedLoginType = this.dataset.type;
                });
            });
            
            loginForm.addEventListener('submit', handleLogin);
            forgotPasswordLink.addEventListener('click', handleForgotPasswordClick);
            forgotPasswordForm.addEventListener('submit', handleForgotPasswordSubmit);
            newPasswordForm.addEventListener('submit', handlePasswordReset);
            resendResetOtp.addEventListener('click', handleResendResetOtp);
            
            document.getElementById('verifyOtpBtn').addEventListener('click', handleOTPVerification);
            document.getElementById('resendOtp').addEventListener('click', handleResendOTP);
        }
        
        function handleForgotPasswordClick(e) {
            e.preventDefault();
            closeLoginModal();
            showForgotPasswordModal();
        }
        
        function handleForgotPasswordSubmit(e) {
            e.preventDefault();
            
            const email = document.getElementById('resetEmail').value.trim().toLowerCase();
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const user = users.find(u => u.email === email && u.userType === 'customer');
            
            if (!user) {
                showToast('Email not found or invalid user type', 'error');
                return;
            }
            
            const resetCode = generateOTP();
            sessionStorage.setItem('resetOTP', resetCode);
            sessionStorage.setItem('resetEmail', email);
            sessionStorage.setItem('resetUserId', user.userId);
            
            const resetExpiry = Date.now() + (10 * 60 * 1000);
            sessionStorage.setItem('resetExpiry', resetExpiry);
            
            console.log('Reset Code:', resetCode);
            
            const templateParams = {
                to_email: email,
                to_name: user.name,
                user_name: user.name,
                user_email: email,
                otp_code: resetCode,
                validity: '10 minutes',
                company_name: 'CSK Automobiles'
            };
            
            emailjs.send(EMAILJS_CONFIG.SERVICE_ID, EMAILJS_CONFIG.TEMPLATE_ID, templateParams)
                .then(function(response) {
                    console.log('Reset code sent!', response.status);
                    showToast('‚úì Reset code sent to your email', 'success');
                    document.getElementById('resetEmailDisplay').textContent = email;
                    closeForgotPasswordModal();
                    showResetPasswordModal();
                })
                .catch(function(error) {
                    console.error('Email error:', error);
                    showToast('‚úì Reset code sent (Check console)', 'success');
                    console.log('Demo Reset Code:', resetCode);
                    document.getElementById('resetEmailDisplay').textContent = email;
                    closeForgotPasswordModal();
                    showResetPasswordModal();
                });
        }
        
        function setupResetOTPInputs() {
            const inputs = document.querySelectorAll('.reset-otp-input');
            inputs.forEach(input => input.value = '');
            inputs.forEach((input, index) => {
                input.replaceWith(input.cloneNode(true));
            });
            
            const newInputs = document.querySelectorAll('.reset-otp-input');
            newInputs.forEach((input, index) => {
                input.addEventListener('input', function(e) {
                    const value = this.value;
                    if (!/^\d*$/.test(value)) {
                        this.value = '';
                        return;
                    }
                    if (value.length === 1 && index < newInputs.length - 1) {
                        newInputs[index + 1].focus();
                    }
                });
                
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Backspace' && !this.value && index > 0) {
                        newInputs[index - 1].focus();
                    }
                });
            });
        }
        
        function startResetOTPTimer() {
            if (resetOtpTimerInterval) clearInterval(resetOtpTimerInterval);
            
            const timerDisplay = document.getElementById('resetOtpTimer');
            resetOtpTimerInterval = setInterval(() => {
                const expiry = parseInt(sessionStorage.getItem('resetExpiry'));
                const remaining = expiry - Date.now();
                
                if (remaining <= 0) {
                    clearInterval(resetOtpTimerInterval);
                    timerDisplay.innerHTML = '<span style="color: #ef4444;">Reset code expired. Please try again.</span>';
                    sessionStorage.removeItem('resetOTP');
                } else {
                    const minutes = Math.floor(remaining / 60000);
                    const seconds = Math.floor((remaining % 60000) / 1000);
                    timerDisplay.innerHTML = `Code expires in: <strong>${minutes}:${seconds.toString().padStart(2, '0')}</strong>`;
                }
            }, 1000);
        }
        
        function handlePasswordReset(e) {
            e.preventDefault();
            
            const inputs = document.querySelectorAll('.reset-otp-input');
            const enteredCode = Array.from(inputs).map(input => input.value).join('');
            const correctCode = sessionStorage.getItem('resetOTP');
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;
            const expiry = parseInt(sessionStorage.getItem('resetExpiry'));
            
            if (enteredCode.length !== 6) {
                showToast('Please enter complete reset code', 'error');
                return;
            }
            
            if (Date.now() > expiry) {
                showToast('Reset code has expired', 'error');
                closeResetPasswordModal();
                return;
            }
            
            if (enteredCode !== correctCode) {
                showToast('Invalid reset code', 'error');
                inputs.forEach(input => input.value = '');
                inputs[0].focus();
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showToast('Passwords do not match', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showToast('Password must be at least 6 characters', 'error');
                return;
            }
            
            // Update password
            const users = JSON.parse(localStorage.getItem('users'));
            const userId = sessionStorage.getItem('resetUserId');
            const userIndex = users.findIndex(u => u.userId === userId);
            
            if (userIndex !== -1) {
                users[userIndex].password = newPassword;
                localStorage.setItem('users', JSON.stringify(users));
                
                sessionStorage.removeItem('resetOTP');
                sessionStorage.removeItem('resetEmail');
                sessionStorage.removeItem('resetUserId');
                sessionStorage.removeItem('resetExpiry');
                
                showToast('‚úì Password reset successful! Please login with your new password.', 'success');
                closeResetPasswordModal();
                showLoginModal();
            }
        }
        
        function handleResendResetOtp(e) {
            e.preventDefault();
            
            const email = sessionStorage.getItem('resetEmail');
            if (!email) {
                showToast('Session expired. Please try again.', 'error');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('users'));
            const user = users.find(u => u.email === email);
            
            if (!user) {
                showToast('User not found', 'error');
                return;
            }
            
            const resetCode = generateOTP();
            sessionStorage.setItem('resetOTP', resetCode);
            const resetExpiry = Date.now() + (10 * 60 * 1000);
            sessionStorage.setItem('resetExpiry', resetExpiry);
            
            console.log('New Reset Code:', resetCode);
            
            const templateParams = {
                to_email: email,
                to_name: user.name,
                user_name: user.name,
                user_email: email,
                otp_code: resetCode,
                validity: '10 minutes',
                company_name: 'CSK Automobiles'
            };
            
            emailjs.send(EMAILJS_CONFIG.SERVICE_ID, EMAILJS_CONFIG.TEMPLATE_ID, templateParams)
                .then(() => {
                    showToast('‚úì New reset code sent', 'success');
                    document.querySelectorAll('.reset-otp-input').forEach(input => input.value = '');
                    document.querySelector('.reset-otp-input').focus();
                    startResetOTPTimer();
                })
                .catch(() => {
                    showToast('‚úì New reset code sent (Check console)', 'success');
                    console.log('Demo Reset Code:', resetCode);
                });
        }
        
        function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value.trim().toLowerCase();
            const password = document.getElementById('password').value;
            
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const user = users.find(u => u.email === email && u.password === password);
            
            if (!user) {
                showToast('Invalid email or password', 'error');
                return;
            }
            
            if (selectedLoginType === 'admin' && user.userType !== 'admin') {
                showToast('Access denied. Admin credentials required.', 'error');
                return;
            }
            
            if (selectedLoginType === 'customer' && user.userType === 'admin') {
                showToast('Please use Admin login', 'error');
                return;
            }
            
            if (!user.verified) {
                showToast('Please verify your email first', 'error');
                return;
            }
            
            currentLoginUser = user;
            
            const otp = generateOTP();
            sessionStorage.setItem('loginOTP', otp);
            sessionStorage.setItem('pendingUser', user.userId);
            
            const otpExpiryTime = Date.now() + (10 * 60 * 1000);
            sessionStorage.setItem('otpExpiry', otpExpiryTime);
            
            console.log('OTP Generated:', otp);
            
            document.getElementById('emailDisplay').textContent = email;
            closeLoginModal();
            sendOTPEmail(email, otp, user.name);
        }
        
        function generateOTP() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }
        
        function sendOTPEmail(email, otp, userName) {
            const recipientEmail = email.trim().toLowerCase();
            
            const templateParams = {
                to_email: recipientEmail,
                to_name: userName,
                user_name: userName,
                user_email: recipientEmail,
                otp_code: otp,
                validity: '10 minutes',
                company_name: 'CSK Automobiles'
            };
            
            emailjs.send(EMAILJS_CONFIG.SERVICE_ID, EMAILJS_CONFIG.TEMPLATE_ID, templateParams)
                .then(function(response) {
                    console.log('OTP email sent!', response.status);
                    showToast('‚úì OTP sent to your email', 'success');
                    showOTPModal();
                })
                .catch(function(error) {
                    console.error('Email error:', error);
                    showToast('‚úì OTP sent (Check console)', 'success');
                    console.log('Demo OTP:', otp);
                    showOTPModal();
                });
        }
        
        function showOTPModal() {
            const modal = document.getElementById('otpModal');
            modal.classList.add('show');
            setupOTPInputs();
            startOTPTimer();
            document.querySelector('.otp-input').focus();
        }
        
        function setupOTPInputs() {
            const inputs = document.querySelectorAll('.otp-input');
            inputs.forEach(input => input.value = '');
            inputs.forEach((input, index) => {
                input.replaceWith(input.cloneNode(true));
            });
            
            const newInputs = document.querySelectorAll('.otp-input');
            newInputs.forEach((input, index) => {
                input.addEventListener('input', function(e) {
                    const value = this.value;
                    if (!/^\d*$/.test(value)) {
                        this.value = '';
                        return;
                    }
                    if (value.length === 1 && index < newInputs.length - 1) {
                        newInputs[index + 1].focus();
                    }
                });
                
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Backspace' && !this.value && index > 0) {
                        newInputs[index - 1].focus();
                    }
                });
                
                input.addEventListener('paste', function(e) {
                    e.preventDefault();
                    const pastedData = e.clipboardData.getData('text');
                    const digits = pastedData.replace(/\D/g, '').split('');
                    digits.forEach((digit, i) => {
                        if (index + i < newInputs.length) {
                            newInputs[index + i].value = digit;
                        }
                    });
                });
            });
        }
        
        function startOTPTimer() {
            if (otpTimerInterval) clearInterval(otpTimerInterval);
            
            const timerDisplay = document.getElementById('otpTimer');
            otpTimerInterval = setInterval(() => {
                const expiry = parseInt(sessionStorage.getItem('otpExpiry'));
                const remaining = expiry - Date.now();
                
                if (remaining <= 0) {
                    clearInterval(otpTimerInterval);
                    timerDisplay.innerHTML = '<span style="color: #ef4444;">OTP expired. Please login again.</span>';
                    sessionStorage.removeItem('loginOTP');
                } else {
                    const minutes = Math.floor(remaining / 60000);
                    const seconds = Math.floor((remaining % 60000) / 1000);
                    timerDisplay.innerHTML = `OTP expires in: <strong>${minutes}:${seconds.toString().padStart(2, '0')}</strong>`;
                }
            }, 1000);
        }
        
        function handleOTPVerification() {
            const inputs = document.querySelectorAll('.otp-input');
            const enteredOTP = Array.from(inputs).map(input => input.value).join('');
            const correctOTP = sessionStorage.getItem('loginOTP');
            const expiry = parseInt(sessionStorage.getItem('otpExpiry'));
            
            if (enteredOTP.length !== 6) {
                showToast('Please enter complete 6-digit OTP', 'error');
                return;
            }
            
            if (Date.now() > expiry) {
                showToast('OTP has expired. Please login again.', 'error');
                sessionStorage.removeItem('loginOTP');
                setTimeout(() => window.location.reload(), 2000);
                return;
            }
            
            if (enteredOTP === correctOTP) {
                const userId = sessionStorage.getItem('pendingUser');
                sessionStorage.setItem('currentUser', userId);
                sessionStorage.removeItem('loginOTP');
                sessionStorage.removeItem('pendingUser');
                sessionStorage.removeItem('otpExpiry');
                
                if (otpTimerInterval) clearInterval(otpTimerInterval);
                
                const users = JSON.parse(localStorage.getItem('users'));
                const user = users.find(u => u.userId === userId);
                
                showToast('Login successful!', 'success');
                
                setTimeout(() => {
                    if (user.userType === 'admin') {
                        window.location.href = 'admin-dashboard.html';
                    } else {
                        window.location.href = 'customer-dashboard.html';
                    }
                }, 1000);
            } else {
                showToast('Invalid OTP. Please try again.', 'error');
                inputs.forEach(input => input.value = '');
                inputs[0].focus();
            }
        }
        
        function handleResendOTP(e) {
            e.preventDefault();
            
            if (!currentLoginUser) {
                showToast('Please login again', 'error');
                setTimeout(() => window.location.reload(), 2000);
                return;
            }
            
            const otp = generateOTP();
            sessionStorage.setItem('loginOTP', otp);
            
            const otpExpiryTime = Date.now() + (10 * 60 * 1000);
            sessionStorage.setItem('otpExpiry', otpExpiryTime);
            
            console.log('New OTP:', otp);
            
            document.querySelectorAll('.otp-input').forEach(input => input.value = '');
            document.querySelector('.otp-input').focus();
            
            startOTPTimer();
            sendOTPEmail(currentLoginUser.email, otp, currentLoginUser.name);
        }

        window.addEventListener('click', function(e) {
            if (e.target === document.getElementById('loginModal')) {
                closeLoginModal();
            }
            if (e.target === document.getElementById('forgotPasswordModal')) {
                closeForgotPasswordModal();
            }
            if (e.target === document.getElementById('resetPasswordModal')) {
                closeResetPasswordModal();
            }
        });
    </script>
</body>
</html>
